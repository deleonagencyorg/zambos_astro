---
import { t, type Locale } from '../../../i18n/i18n';

interface Props {
  currentLang: Locale;
}

interface Message {
  title: string;
  link?: string;
}

const { currentLang } = Astro.props;

// Obtener los mensajes del archivo de traducci√≥n
const messages = t('messagetop', { namespace: 'common', locale: currentLang }) as Message[] || [];
---

<div id="message-carousel" class="w-full bg-[#ca0203]  text-white py-8 md:py-4  relative overflow-hidden z-10">
  <div class="container mx-auto px-4">
    <div class="message-slider flex items-center justify-center min-h-[1.5rem] md:min-h-[2rem] relative">
      {messages.map((message: Message, index: number) => (
        <div class="message-slide absolute w-full text-center transition-all duration-700 transform" 
             data-index={index} 
             style={index === 0 ? "opacity: 1; transform: translateY(0)" : "opacity: 0; transform: translateY(20px)"}>
          {message.link ? (
            <a href={message.link} class="text-white hover:underline text-md md:text-lg font-medium">
              {message.title}
            </a>
          ) : (
            <span class="text-md md:text-lg font-medium">{message.title}</span>
          )}
        </div>
      ))}
    </div>
  </div>
  <div class="absolute top-0 bottom-0 left-4 flex items-center">
    <button id="prev-message" class="text-white p-1 hover:bg-white hover:bg-opacity-20 rounded-full transition-all duration-300" aria-label="Mensaje anterior">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
  </div>
  <div class="absolute top-0 bottom-0 right-4 flex items-center">
    <button id="next-message" class="text-white p-1 hover:bg-white hover:bg-opacity-20 rounded-full transition-all duration-300" aria-label="Siguiente mensaje">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>
</div>

<script>
  (function() {
    var messageCarouselInterval = null;

    function initMessageCarousel() {
      var container = document.getElementById('message-carousel');
      if (!container) return;
      if (container.dataset.messageCarouselInitialized === 'true') return;
      container.dataset.messageCarouselInitialized = 'true';

      var slides = container.querySelectorAll('.message-slide');
      var totalSlides = slides.length;
      var currentSlide = 0;
      
      var prevButton = document.getElementById('prev-message');
      var nextButton = document.getElementById('next-message');

      function showSlide(index) {
        slides.forEach(function(slide, i) {
          if (i === index) {
            slide.style.opacity = '1';
            slide.style.transform = 'translateY(0)';
            slide.style.zIndex = '1';
            slide.classList.add('active-slide');
          } else {
            slide.style.opacity = '0';
            slide.style.transform = 'translateY(20px)';
            slide.style.zIndex = '0';
            slide.classList.remove('active-slide');
          }
        });
      }
      
      function nextSlide() {
        currentSlide = (currentSlide + 1) % totalSlides;
        showSlide(currentSlide);
      }
      
      function prevSlideFunc() {
        currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
        showSlide(currentSlide);
      }
      
      function startAutoRotation() {
        if (messageCarouselInterval) clearInterval(messageCarouselInterval);
        messageCarouselInterval = setInterval(nextSlide, 5000);
      }
      
      function resetAutoRotation() {
        if (messageCarouselInterval) clearInterval(messageCarouselInterval);
        startAutoRotation();
      }
      
      if (prevButton) {
        prevButton.addEventListener('click', function() {
          prevSlideFunc();
          resetAutoRotation();
        });
      }
      
      if (nextButton) {
        nextButton.addEventListener('click', function() {
          nextSlide();
          resetAutoRotation();
        });
      }
      
      startAutoRotation();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMessageCarousel);
    } else {
      initMessageCarousel();
    }

    document.addEventListener('astro:page-load', initMessageCarousel);
    document.addEventListener('astro:after-swap', initMessageCarousel);
  })();
</script>
