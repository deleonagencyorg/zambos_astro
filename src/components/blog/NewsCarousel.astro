---
// src/components/common/NewsletterBanner.astro
import { type Locale } from '../../i18n/i18n';

export interface Props {
  currentLang?: Locale;
  id?: string; 
  items?: any[];
}

const { currentLang, id, items } = Astro.props;

const data = Array.isArray(items) ? items : [];
const latestPost = data
  .slice()
  .sort((a, b) => String(b?.published_date || '').localeCompare(String(a?.published_date || '')))[0];

const latestTitle = String(latestPost?.title || '');
const latestContent = String(latestPost?.content || latestPost?.summary || '');
const latestExcerpt = latestContent.replace(/<[^>]*>/g, '').slice(0, 180).trim() + (latestContent.length > 180 ? '…' : '');
const latestImage = String(latestPost?.image_banner || latestPost?.image || '');
const latestSlug = String(latestPost?.slug || latestPost?.id || '');
const latestHref = latestSlug ? `/${currentLang || 'es'}/blog/${latestSlug}` : '';
const readMoreLabel = currentLang === 'es' ? 'Leer más' : 'Read more';

const newsletter = {
  es: {
    title: 'ÚNETE A NUESTRO BOLETÍN',
    subtitle: 'Entérate de nuestras últimas novedades en experiencias, sabores y más.',
    button: 'Suscríbeme'
  },
  en: {
    bannerTitle: 'Your new favorite flavor: Zambos Garlic Parmesan',
    bannerSubtitle: 'With the perfect combination of flavors you need. Try it now',
    title: 'JOIN OUR NEWSLETTER',
    subtitle: 'Stay informed about our latest news on experiences, flavors and more.',
    placeholder: 'Email address',
    button: 'Subscribe'
  },
  us: {
    bannerTitle: 'Your new favorite flavor: Zambos Garlic Parmesan',
    bannerSubtitle: 'With the perfect combination of flavors you need. Try it now',
    title: 'JOIN OUR NEWSLETTER',
    subtitle: 'Stay informed about our latest news on experiences, flavors and more.',
    button: 'Subscribe'
  }
};

const nl = newsletter[currentLang || 'es'] || newsletter.en || newsletter.es;
---

<div class="w-full">
  <!-- Hero: latest post -->
  {latestPost && (
    <div class="hero-banner relative w-full rounded-2xl overflow-hidden" style="height: 460px;">
      <!-- Background image -->
      {latestImage ? (
        <img
          src={latestImage}
          alt={latestTitle}
          class="absolute inset-0 w-full h-full object-cover object-center" style="filter: blur(2px); transform: scale(1.04);"
          loading="eager"
        />
      ) : (
        <div class="absolute inset-0 bg-gray-800"></div>
      )}

      <!-- Dark gradient overlay -->
      <div class="absolute inset-0" style="background: linear-gradient(to top, rgba(0,0,0,0.80) 0%, rgba(0,0,0,0.35) 55%, rgba(0,0,0,0.10) 100%);"></div>

      <!-- Content overlay -->
      <div class="absolute bottom-0 left-0 right-0 px-6 md:px-10 pb-8 pt-16">
        <p class="text-white text-xs md:text-sm font-semibold uppercase tracking-widest mb-2 opacity-80">
          {latestPost?.category || ''}
        </p>
        <h2 class="text-white font-bold text-xl md:text-3xl leading-tight mb-3 uppercase" style="text-shadow: 0 2px 8px rgba(0,0,0,0.5);">
          {latestTitle}
        </h2>
        {latestExcerpt && (
          <p class="text-white text-sm md:text-base mb-5 max-w-2xl opacity-90 line-clamp-2" style="text-shadow: 0 1px 4px rgba(0,0,0,0.5);">
            {latestExcerpt}
          </p>
        )}
        {latestHref && (
          <a
            href={latestHref}
            class="inline-block bg-red text-white font-bold px-8 py-3 rounded-full hover:opacity-90 transition text-sm uppercase tracking-wide"
          >
            {readMoreLabel}
          </a>
        )}
      </div>
    </div>
  )}

  <!-- Green Newsletter Section -->
  {currentLang === 'es' && (
    <div class="bg-[#009337] text-center py-10 px-6 rounded-xl mt-[30px]">
      <h2 class="text-white text-2xl md:text-3xl font-bold mb-3 uppercase tracking-wider">
        {nl.title}
      </h2>
      <p class="text-white text-sm md:text-base mb-6 max-w-xl mx-auto">
        {nl.subtitle}
      </p>
      <a
        href="https://www.snacksyummies.com/es/yummiesone"
        class="submit-button bg-red"
        target="_blank"
        rel="noopener noreferrer"
      >
        {nl.button}
      </a>
    </div>
  )}
</div>

<style>
  .submit-button {
    display: inline-block;
    padding: 12px 40px;
    font-size: 1rem;
    font-weight: 600;
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 160px;
    text-decoration: none;
  }
  .submit-button:hover {
    opacity: 0.9;
  }
</style>