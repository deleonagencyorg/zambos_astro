---
import Layout from '../../layouts/MainLayout.astro';
import { t } from '../../i18n/i18n';
import type { Locale } from '../../i18n/i18n';
import type { HeaderColorConfig } from '../../config/headerColors';
import Breadcrumb from '../../components/common/Breadcrumb/Breadcrumb.astro';
import { fade } from 'astro:transitions';
import VideoHero from '../../components/common/VideoHero/VideoHero.astro';
import LazyImage from '../../components/common/LazyImage.astro';
import Subscription from '../../components/subscription/index.astro';

// Importar estilos separados
import './styles.css';

export interface Props {
  currentLang: Locale;
  headerColorConfig: HeaderColorConfig;
}

const { currentLang, headerColorConfig } = Astro.props;

// Get translations from common.json
const title = t('about_us.title', { namespace: 'common', locale: currentLang });
const metaDescription = t('meta.about_us.description', { namespace: 'common', locale: currentLang });

// Importar contenido específico de aboutus.json
const aboutUsContent = await import(`../../locales/${currentLang}/aboutus.json`);
const historyTitle = aboutUsContent.title;
const historySubtitle = aboutUsContent.subtitle;
const historyIntro = aboutUsContent.intro;
const historyItems = aboutUsContent.items;
const historyConclusion = aboutUsContent.conclusion;

// Get social media data from common.json
const commonContent = await import(`../../locales/${currentLang}/common.json`);
const socialMediaArray = Object.values(commonContent.social_media);

// Video and image URLs for hero section
const videoUrl = 'https://snack.yummiespromociones.com/SnacksyummiesAssets/YUMMIES_INSTITUCIONAL_1920X1080.webm';
const fallbackImageUrl = 'https://snack.yummiespromociones.com/SnacksyummiesAssets/portada_video.webp';
---

<Layout title={title} class="bg-[#0DB04A]" description={metaDescription}>
<div>
  <div class="mx-auto ">
    <div class="mt-12">
      <!-- Timeline Container -->
      <div class="timeline-horizontal-container ">
        
        <!-- Content Card -->
        <div class="timeline-content-wrapper relative md:mb-12 mb-24">
          {historyItems.map((item: { year?: string; title?: string; image: string; text: string }, index: number) => (
            <div 
              class={`timeline-slide ${index === 0 ? '' : 'hidden'}`}
              data-slide={index}
            >
              <div class="flex flex-col md:flex-row gap-8 items-center px-4 sm:px-8 md:px-12 lg:px-24">
                
                <div class="w-full md:w-[50%] max-w-[900px]">
                  {item.year && item.title ? (
                    <div class={`text-white font-title mb-4 flex flex-wrap items-baseline gap-4 animate-fade-in-up leading-tight tracking-tight break-words ${(((item.title ?? '').length + (item.year ?? '').length) > 28)
                      ? 'text-[clamp(1.5rem,4.5vw,2.5rem)] md:text-[clamp(2rem,3.5vw,3rem)]'
                      : 'text-[clamp(1.75rem,5.5vw,3rem)] md:text-[clamp(2.5rem,4vw,3.5rem)]'}`}>
                      <span class="font-title">{item.year}</span>
                      <span class="px-2" aria-hidden="true">|</span>
                      <span class="font-title">{item.title}</span>
                    </div>
                  ) : item.year ? (
                    <h2 class={`text-white font-title mb-4 animate-fade-in-up leading-tight tracking-tight break-words ${((item.year ?? '').length > 8)
                      ? 'text-[clamp(1.5rem,4.5vw,2.5rem)] md:text-[clamp(2rem,3.5vw,3rem)]'
                      : 'text-[clamp(1.75rem,5.5vw,3rem)] md:text-[clamp(2.5rem,4vw,3.5rem)]'}`}>{item.year}</h2>
                  ) : item.title ? (
                    <h3 class={`text-white font-title mb-4 animate-fade-in-up leading-tight tracking-tight break-words ${((item.title ?? '').length > 28)
                      ? 'text-[clamp(1.5rem,4.5vw,2.5rem)] md:text-[clamp(2rem,3.5vw,3rem)]'
                      : 'text-[clamp(1.75rem,5.5vw,3rem)] md:text-[clamp(2.5rem,4vw,3.5rem)]'}`}>{item.title}</h3>
                  ) : null}
                  <p class="text-white text-lg md:text-xl leading-relaxed">
                    {item.text}
                  </p>
                </div>

                <div class="w-full md:w-[50%] flex justify-center md:justify-end pt-8 md:pt-24">
                  <!-- Container amarillo -->
                  <div class="bg-[#FFED7A] rounded-2xl shadow-lg p-4 sm:p-6 md:p-8 flex items-center justify-center w-full max-w-[583px] aspect-[583/400]">
                    <LazyImage 
                      class="rounded-2xl transform hover:scale-105 transition-transform duration-300 object-cover w-full h-full max-w-[450px] max-h-[450px]" 
                      src={item.image} 
                      alt={item.title ?? item.year ?? 'about-us item'}
                    />
                  </div>
                </div>

              </div>
            </div>
          ))}

            <div
            class="absolute z-30 bottom-[60px] left-4 sm:left-8 md:left-12 lg:left-[100px] hidden lg:block"
            >
              <p class="text-white pb-2 text-sm md:text-base">{currentLang==='es' ? 'Síguenos en nuestras redes' : 'Follow us on our social media'}</p>
              <div class="flex flex-row gap-5">
                {socialMediaArray.map((social: any) => {
                  const platform = String(social?.name ?? '').toLowerCase();
                  return (
                  <a href={social.url} target="_blank" rel="noopener noreferrer" class="bg-[#FF0001] p-3 md:p-[15px] rounded-full flex items-center justify-center hover:scale-110 transition-transform">
                    {(platform.includes('insta')) && (
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zM12 7.1A4.9 4.9 0 1 0 12 17a4.9 4.9 0 0 0 0-9.8zM18.4 6.6a1.15 1.15 0 1 0 0-2.3 1.15 1.15 0 0 0 0 2.3z"/>
                      </svg>
                    )}
                    {(platform.includes('face')) && (
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.5c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.4h-1.2c-1.2 0-1.6.8-1.6 1.5V12H16l-.5 3h-2.5v7A10 10 0 0 0 22 12z"/>
                      </svg>
                    )}
                    {(platform.includes('tiktok')) && (
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21 8.3a6.7 6.7 0 0 1-4.3-1.5v8.6a6 6 0 1 1-6-6c.3 0 .6 0 .9.1v3.1a2.8 2.8 0 1 0 2.1 2.7V2h3.3A6.7 6.7 0 0 0 21 6.3v2z"/>
                      </svg>
                    )}
                  </a>
                  );
                })}
              </div>
            </div>

            <div
            class="absolute z-30 bottom-[60px] left-4 sm:left-8 md:left-12 hidden md:block lg:hidden"
            >
              <p class="text-white pb-2 text-sm md:text-base">{currentLang==='es' ? 'Síguenos en nuestras redes' : 'Follow us on our social media'}</p>
              <div class="flex flex-row gap-5">
                {socialMediaArray.map((social: any) => {
                  const platform = String(social?.name ?? '').toLowerCase();
                  return (
                  <a href={social.url} target="_blank" rel="noopener noreferrer" class="bg-[#FF0001] p-3 md:p-[15px] rounded-full flex items-center justify-center hover:scale-110 transition-transform">
                    {(platform.includes('insta')) && (
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zM12 7.1A4.9 4.9 0 1 0 12 17a4.9 4.9 0 0 0 0-9.8zM18.4 6.6a1.15 1.15 0 1 0 0-2.3 1.15 1.15 0 0 0 0 2.3z"/>
                      </svg>
                    )}
                    {(platform.includes('face')) && (
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.5c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.4h-1.2c-1.2 0-1.6.8-1.6 1.5V12H16l-.5 3h-2.5v7A10 10 0 0 0 22 12z"/>
                      </svg>
                    )}
                    {(platform.includes('tiktok')) && (
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21 8.3a6.7 6.7 0 0 1-4.3-1.5v8.6a6 6 0 1 1-6-6c.3 0 .6 0 .9.1v3.1a2.8 2.8 0 1 0 2.1 2.7V2h3.3A6.7 6.7 0 0 0 21 6.3v2z"/>
                      </svg>
                    )}
                  </a>
                  );
                })}
              </div>
            </div>

            <div
            class="relative z-30 left-4 block md:hidden mt-12 mb-8"
            >
              <p class="text-white pb-2 text-sm">{currentLang==='es' ? 'Síguenos en nuestras redes' : 'Follow us on our social media'}</p>
              <div class="flex flex-row gap-5">
                {socialMediaArray.map((social: any) => {
                  const platform = String(social?.name ?? '').toLowerCase();
                  return (
                  <a href={social.url} target="_blank" rel="noopener noreferrer" class="bg-[#FF0001] p-3 md:p-[15px] rounded-full flex items-center justify-center hover:scale-110 transition-transform">
                    {(platform.includes('insta')) && (
                      <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zM12 7.1A4.9 4.9 0 1 0 12 17a4.9 4.9 0 0 0 0-9.8zM18.4 6.6a1.15 1.15 0 1 0 0-2.3 1.15 1.15 0 0 0 0 2.3z"/>
                      </svg>
                    )}
                    {(platform.includes('face')) && (
                      <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.5c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.4h-1.2c-1.2 0-1.6.8-1.6 1.5V12H16l-.5 3h-2.5v7A10 10 0 0 0 22 12z"/>
                      </svg>
                    )}
                    {(platform.includes('tiktok')) && (
                      <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21 8.3a6.7 6.7 0 0 1-4.3-1.5v8.6a6 6 0 1 1-6-6c.3 0 .6 0 .9.1v3.1a2.8 2.8 0 1 0 2.1 2.7V2h3.3A6.7 6.7 0 0 0 21 6.3v2z"/>
                      </svg>
                    )}
                  </a>
                  );
                })}
              </div>
            </div>
        </div>

          <!-- Timeline Line with Points -->
          <div class="timeline-line-wrapper relative -mt-[50px] md:mt-0 mb-10 px-4 sm:px-8 md:px-12 lg:px-20 mx-auto max-w-[90%] md:max-w-[100%]">
            <!-- Line - Ahora es blanca -->
            <div class="absolute top-1/2 left-[40px] sm:left-[60px] md:left-[80px] right-[40px] sm:right-[50px] md:right-[80px] h-[3px] md:h-[4px] bg-white transform -translate-y-1/2"></div>
            
            <!-- Points -->
            <div class="relative flex justify-between items-center">
              {historyItems.map((item: { year?: string; title?: string; image: string; text: string }, index: number) => (
                <button
                  class="timeline-point-btn relative z-10"
                  data-index={index}
                  aria-label={`Ver ${item.year ? `año ${item.year}` : (item.title ?? 'elemento')}`}
                >
                  <div class="timeline-point bg-[#FFF] border-4 rounded-full transition-all duration-300 hover:scale-125 hover:bg-primary cursor-pointer"
                    data-year={item.year ?? ''}>
                  </div>
                </button>
              ))}
            </div>
          </div>

        <!-- Navigation Arrows - Ahora son blancos -->
        <div class="navigation-arrows flex justify-end gap-3 md:gap-4 mt-4 mb-8 md:mb-[40px] pr-4 sm:pr-8 md:pr-12 lg:pr-[60px]">
          <button 
            id="prevBtn"
            class="nav-arrow bg-white hover:bg-quinary text-black rounded-2xl w-10 h-10 md:w-12 md:h-12 transition-all duration-300 hover:scale-110 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
            aria-label="Anterior"
          >
            <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          
          <button 
            id="nextBtn"
            class="nav-arrow bg-white hover:bg-quinary text-black rounded-2xl w-10 h-10 md:w-12 md:h-12 transition-all duration-300 hover:scale-110 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
            aria-label="Siguiente"
          >
            <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>

        <!-- Pagination Dots -->
        <div class="hidden justify-center gap-3 mt-2">
          {historyItems.map((item: { year?: string; title?: string }, index: number) => (
            <button
              class={`pagination-dot w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-primary w-8' : 'bg-quinary hover:bg-primary'}`}
              data-dot={index}
              aria-label={`Ir a ${item.year ? `año ${item.year}` : (item.title ?? `elemento ${index + 1}`)}`}
            ></button>
          ))}
        </div>

      </div>
      
    </div>

    <section>
      <Subscription />
    </section>
  </div>
</Layout>

<style>
  .nav-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .timeline-point {
    width: 16px;
    height: 16px;
  }

  @media (min-width: 640px) {
    .timeline-point {
      width: 18px;
      height: 18px;
    }
  }

  @media (min-width: 768px) {
    .timeline-point {
      width: 20px;
      height: 20px;
    }
  }

  .timeline-point-btn:hover .timeline-point {
    width: 22px;
    height: 22px;
  }

  @media (min-width: 640px) {
    .timeline-point-btn:hover .timeline-point {
      width: 24px;
      height: 24px;
    }
  }

  @media (min-width: 768px) {
    .timeline-point-btn:hover .timeline-point {
      width: 28px;
      height: 28px;
    }
  }

  .timeline-content-wrapper {
    min-height: 400px;
  }

  @media (min-width: 640px) {
    .timeline-content-wrapper {
      min-height: 450px;
    }
  }

  @media (min-width: 768px) {
    .timeline-content-wrapper {
      min-height: 500px;
    }
  }

  @media (min-width: 1024px) {
    .timeline-content-wrapper {
      min-height: 550px;
    }
  }

  .timeline-slide {
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .timeline-slide.active {
    opacity: 1 !important;
    transform: translateX(0) !important;
  }

  .pagination-dot.active {
    background-color: var(--primary-color, #0a3d7e);
    width: 2rem;
  }

  .timeline-point.active {
    width: 22px;
    height: 22px;
    background-color: var(--quinary-color, #009337);
  }

  @media (min-width: 640px) {
    .timeline-point.active {
      width: 24px;
      height: 24px;
    }
  }

  @media (min-width: 768px) {
    .timeline-point.active {
      width: 28px;
      height: 28px;
    }
  }
</style>

<script>
  // Timeline navigation functionality
  let currentIndex = 0;
  const slides = document.querySelectorAll('.timeline-slide');
  const dots = document.querySelectorAll('.pagination-dot');
  const points = document.querySelectorAll('.timeline-point');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const totalSlides = slides.length;

  function updateTimeline(newIndex: number) {
    if (newIndex < 0 || newIndex >= totalSlides) return;

    // Ocultar el slide actual
    slides[currentIndex].classList.remove('active');
    slides[currentIndex].classList.add('hidden');
    
    // Remove active from dots and points
    dots[currentIndex]?.classList.remove('active');
    points[currentIndex]?.classList.remove('active');

    // Mostrar el nuevo slide
    slides[newIndex].classList.remove('hidden');
    setTimeout(() => {
      slides[newIndex].classList.add('active');
    }, 50);
    
    // Add active to new dots and points
    dots[newIndex]?.classList.add('active');
    points[newIndex]?.classList.add('active');
    
    currentIndex = newIndex;
    updateButtons();
  }

  function updateButtons() {
    if (prevBtn && nextBtn) {
      (prevBtn as HTMLButtonElement).disabled = currentIndex === 0;
      (nextBtn as HTMLButtonElement).disabled = currentIndex === totalSlides - 1;
    }
  }

  // Initialize first slide
  if (slides.length > 0) {
    slides[0].classList.add('active');
    dots[0]?.classList.add('active');
    points[0]?.classList.add('active');
  }

  // Navigation buttons
  prevBtn?.addEventListener('click', () => {
    if (currentIndex > 0) {
      updateTimeline(currentIndex - 1);
    }
  });

  nextBtn?.addEventListener('click', () => {
    if (currentIndex < totalSlides - 1) {
      updateTimeline(currentIndex + 1);
    }
  });

  // Pagination dots
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      updateTimeline(index);
    });
  });

  // Timeline points
  document.querySelectorAll('.timeline-point-btn').forEach((btn, index) => {
    btn.addEventListener('click', () => {
      updateTimeline(index);
    });
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft' && currentIndex > 0) {
      updateTimeline(currentIndex - 1);
    } else if (e.key === 'ArrowRight' && currentIndex < totalSlides - 1) {
      updateTimeline(currentIndex + 1);
    }
  });

  // Initialize button states
  updateButtons();
</script>