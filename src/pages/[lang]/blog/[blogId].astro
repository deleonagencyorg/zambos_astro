---
import BlogDetail from '../../../views/Blog/Detail/index.astro';
import BlogDetailUS from '../../../views-us/Blog/Detail/index.astro';
import { setLocale, type Locale } from '../../../i18n/i18n';
import MainLayout from '../../../layouts/MainLayout.astro';
import MainLayoutUS from '../../../layouts/MainLayoutUS.astro';

export async function getStaticPaths() {
  const locales = ['us', 'es'];
  const paths: any[] = [];
  
  // Importar archivos blog.json de cada locale
  const modules = import.meta.glob('../../../locales/*/blog.json');
  
  for (const locale of locales) {
    const modulePath = `../../../locales/${locale}/blog.json`;
    const mod: any = modules[modulePath] ? await modules[modulePath]() : null;
    
    if (!mod) continue;
    
    const data = mod.default || mod;
    const allPosts: any[] = data.posts || [];
    
    for (const blogPost of allPosts) {
      if (blogPost.slug || blogPost.id) {
        paths.push({
          params: { lang: locale, blogId: blogPost.slug || blogPost.id },
          props: { blogPost, currentLang: locale as Locale, allBlogPosts: allPosts }
        });
      }
    }
  }
  
  return paths;
}

const { blogPost, currentLang, allBlogPosts } = Astro.props;
const { lang, blogId } = Astro.params;

setLocale(lang as Locale);
const isUS = currentLang === 'us';
const Layout = isUS ? MainLayoutUS : MainLayout;
const DetailComponent = isUS ? BlogDetailUS : BlogDetail;
---

<Layout title={blogPost.title}>
  <DetailComponent blogPost={blogPost} currentLang={currentLang} allBlogPosts={allBlogPosts} />
</Layout>