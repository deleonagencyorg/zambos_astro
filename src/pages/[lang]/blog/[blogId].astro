---
import BlogDetail from '../../../views/Blog/Detail/index.astro';
import { setLocale, type Locale } from '../../../i18n/i18n';
import MainLayout from '../../../layouts/MainLayout.astro';

export async function getStaticPaths() {
  const locales = ['en', 'es'];
  const paths: any[] = [];
  const blogModules = import.meta.glob('../../../locales/*/blogs/*.json');
  const postsByLocale: Record<string, any[]> = { en: [], es: [] };

  for (const path in blogModules) {
    const lang = path.split('/')[4];
    if (locales.includes(lang)) {
      const mod: any = await blogModules[path]();
      postsByLocale[lang].push(mod.default || mod);
    }
  }

  for (const locale of locales) {
    const allPosts = postsByLocale[locale];
    for (const blogPost of allPosts) {
      const blogId = blogPost.slug || blogPost.id;
      if (blogId) {
        paths.push({
          params: { lang: locale, blogId },
          props: { blogPost, currentLang: locale as Locale, allBlogPosts: allPosts }
        });
      }
    }
  }

  return paths;
}

const { blogPost, currentLang, allBlogPosts } = Astro.props;
const { lang } = Astro.params;

setLocale(lang as Locale);
---

<MainLayout title={blogPost.title}>
  <BlogDetail blogPost={blogPost} currentLang={currentLang} allBlogPosts={allBlogPosts} />
</MainLayout>