---
import BlogListing from '../../../views/Blog/index.astro';
import { type Locale } from '../../../i18n/i18n';

export async function getStaticPaths() {
  const locales = ['en', 'es'];
  const blogModules = import.meta.glob('../../../locales/*/blogs/*.json');
  const postsByLocale: Record<string, any[]> = { en: [], es: [] };

  for (const path in blogModules) {
    const lang = path.split('/')[4];
    if (locales.includes(lang)) {
      const mod: any = await blogModules[path]();
      postsByLocale[lang].push(mod.default || mod);
    }
  }

  return locales.map((locale) => ({
    params: { lang: locale },
    props: { currentLang: locale as Locale, blogPosts: postsByLocale[locale] }
  }));
}

const { currentLang, blogPosts } = Astro.props;
---

<BlogListing blogPosts={blogPosts} currentLang={currentLang} />
